import com.efluid.jenkinsfile.Jenkinsfile

// variables globales
node('socle-jenkins-maven-docker-14-4G'){

git branch: env.BRANCH_NAME, credentialsId: '4adbeffc-4d68-43a1-b44e-d3de9ceace04', url: 'https://github.com/Zenika/GestionParamEfluid.git'

try{
	sh 'mvn clean deploy -DskipTests=true'
	sh 'cp param-app/target/param-app-exec.jar param-app/src/docker/build-serv-efluid/standalone-with-h2'
	sh "docker build -t ${variables.artifactoryDockerRegistryAlias}/datagate param-app/src/docker/build-serv-efluid/standalone-with-h2"
	sh "docker push ${variables.artifactoryDockerRegistryAlias}/datagate"
} catch (Exception e) {
	mail bcc: '', body: """GestionParamEfluid en erreur 

	${env.BUILD_URL}""", cc: '', from: 'usinelogicielle@efluid.fr', replyTo: '', subject: 'Test GestionParamEfluid', to: 'm-coste@efluid.fr'
	throw e
}
}
return this;